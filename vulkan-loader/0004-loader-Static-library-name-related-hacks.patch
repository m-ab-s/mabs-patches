From 1cfe2ef16832f382ad6ff5cc2ea3e0280ca6fab7 Mon Sep 17 00:00:00 2001
From: Christopher Degawa <ccom@randomderp.com>
Date: Mon, 2 Oct 2023 01:38:44 -0500
Subject: [PATCH 4/6] loader: Static library name related hacks

Re-adds the lib prefix and removes the so-ver suffixes

Signed-off-by: Christopher Degawa <ccom@randomderp.com>
---
 loader/CMakeLists.txt | 18 +++++++++++-------
 1 file changed, 11 insertions(+), 7 deletions(-)

diff --git a/loader/CMakeLists.txt b/loader/CMakeLists.txt
index 383ef83fa..10d7b032a 100644
--- a/loader/CMakeLists.txt
+++ b/loader/CMakeLists.txt
@@ -387,14 +387,18 @@ if(WIN32)
     # when adding the suffix the import and runtime library names must be consistent
     # mingw: libvulkan-1.dll.a / vulkan-1.dll
     # msvc: vulkan-1.lib / vulkan-1.dll
-    set_target_properties(vulkan
-                          PROPERTIES
-                          OUTPUT_NAME ${API_TYPE}-1)
-    if(MINGW)
-        # generate the same DLL with mingw
+    if (NOT BUILD_STATIC_LOADER)
         set_target_properties(vulkan
                               PROPERTIES
-                              PREFIX "")
+                              OUTPUT_NAME ${API_TYPE}-1)
+        if(MINGW)
+            # generate the same DLL with mingw
+            set_target_properties(vulkan
+                                  PROPERTIES
+                                  PREFIX "")
+        endif()
+    endif()
+    if(MINGW)
         # let the linker just fix up the stdcall mangling, like on msvc
         if(CMAKE_SIZEOF_VOID_P EQUAL 4)
             target_link_options(vulkan PRIVATE "-Wl,--enable-stdcall-fixup")
@@ -564,7 +568,7 @@ if (PKG_CONFIG_FOUND)
         set(PRIVATE_LIBS "Libs.private: ${PRIVATE_LIBS}")
     endif()
 
-    if(WIN32)
+    if(WIN32 AND NOT BUILD_STATIC_LOADER)
         if(MINGW)
             set(VULKAN_LIB_SUFFIX "-1.dll")
         else()
-- 
2.52.0

